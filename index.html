<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Colour Calendar</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-100 flex items-start justify-center pt-8">
  <div id="root"></div>
  <script type="text/babel" data-type="module">
    const { useState } = React;

    const ChevronLeft = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>
    );
    const ChevronRight = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>
    );
    const Pencil = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
    );
    const Trash = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
    );
    const Plus = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
    );

    const COLOR_PALETTE = [
      { bg: 'bg-slate-200', hover: 'hover:bg-slate-300' },
      { bg: 'bg-gray-200', hover: 'hover:bg-gray-300' },
      { bg: 'bg-red-200', hover: 'hover:bg-red-300' },
      { bg: 'bg-orange-200', hover: 'hover:bg-orange-300' },
      { bg: 'bg-amber-200', hover: 'hover:bg-amber-300' },
      { bg: 'bg-yellow-200', hover: 'hover:bg-yellow-300' },
      { bg: 'bg-lime-200', hover: 'hover:bg-lime-300' },
      { bg: 'bg-green-200', hover: 'hover:bg-green-300' },
      { bg: 'bg-emerald-200', hover: 'hover:bg-emerald-300' },
      { bg: 'bg-teal-200', hover: 'hover:bg-teal-300' },
      { bg: 'bg-cyan-200', hover: 'hover:bg-cyan-300' },
      { bg: 'bg-sky-200', hover: 'hover:bg-sky-300' },
      { bg: 'bg-blue-200', hover: 'hover:bg-blue-300' },
      { bg: 'bg-indigo-200', hover: 'hover:bg-indigo-300' },
      { bg: 'bg-violet-200', hover: 'hover:bg-violet-300' },
      { bg: 'bg-purple-200', hover: 'hover:bg-purple-300' },
      { bg: 'bg-fuchsia-200', hover: 'hover:bg-fuchsia-300' },
      { bg: 'bg-pink-200', hover: 'hover:bg-pink-300' },
      { bg: 'bg-rose-200', hover: 'hover:bg-rose-300' },
    ];

    const defaultLegend = () => [
      { id: 'none', name: 'None', bg: 'bg-white', hover: 'hover:bg-gray-50' },
      { id: '1', name: 'Work', bg: 'bg-blue-200', hover: 'hover:bg-blue-300' },
      { id: '2', name: 'Personal', bg: 'bg-green-200', hover: 'hover:bg-green-300' },
      { id: '3', name: 'Travel', bg: 'bg-amber-200', hover: 'hover:bg-amber-300' },
      { id: '4', name: 'Health', bg: 'bg-emerald-200', hover: 'hover:bg-emerald-300' },
      { id: '5', name: 'Family', bg: 'bg-pink-200', hover: 'hover:bg-pink-300' },
      { id: '6', name: 'Holiday', bg: 'bg-purple-200', hover: 'hover:bg-purple-300' },
      { id: '7', name: 'Other', bg: 'bg-slate-200', hover: 'hover:bg-slate-300' },
    ];

    const ColorCalendar = () => {
      const [currentDate, setCurrentDate] = useState(new Date());
      const [coloredDays, setColoredDays] = useState({});
      const [legend, setLegend] = useState(() => defaultLegend());
      const [editingId, setEditingId] = useState(null);
      const [newLabelName, setNewLabelName] = useState('');
      const [editingColorId, setEditingColorId] = useState(null);
      const [showAddForm, setShowAddForm] = useState(false);
      const [addName, setAddName] = useState('');
      const [addColorIdx, setAddColorIdx] = useState(0);

      const monthNames = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
      ];

      const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

      const getDaysInMonth = (date) => {
        const year = date.getFullYear();
        const month = date.getMonth();
        return new Date(year, month + 1, 0).getDate();
      };

      const getFirstDayOfMonth = (date) => {
        const year = date.getFullYear();
        const month = date.getMonth();
        return new Date(year, month, 1).getDay();
      };

      const handleDayClick = (day) => {
        const key = `${currentDate.getFullYear()}-${currentDate.getMonth()}-${day}`;
        const currentId = coloredDays[key] ?? 'none';
        const idx = legend.findIndex((e) => e.id === currentId);
        const nextIdx = (idx + 1) % legend.length;
        setColoredDays({ ...coloredDays, [key]: legend[nextIdx].id });
      };

      const getLegendEntry = (id) => legend.find((e) => e.id === id) ?? legend[0];
      const nextId = () => String(Math.max(0, ...legend.filter((e) => e.id !== 'none').map((e) => parseInt(e.id, 10) || 0)) + 1);

      const updateLegendName = (id, name) => {
        setLegend((prev) => prev.map((e) => (e.id === id ? { ...e, name: name.trim() || e.name } : e)));
        setEditingId(null);
      };
      const updateLegendColor = (id, colorIdx) => {
        const c = COLOR_PALETTE[colorIdx];
        setLegend((prev) => prev.map((e) => (e.id === id ? { ...e, bg: c.bg, hover: c.hover } : e)));
      };
      const removeLegendEntry = (id) => {
        if (id === 'none') return;
        setLegend((prev) => prev.filter((e) => e.id !== id));
        setColoredDays((prev) => {
          const out = { ...prev };
          Object.keys(out).forEach((k) => { if (out[k] === id) out[k] = 'none'; });
          return out;
        });
      };
      const addLegendEntry = () => {
        const name = addName.trim() || 'New label';
        const c = COLOR_PALETTE[addColorIdx];
        setLegend((prev) => [...prev, { id: nextId(), name, bg: c.bg, hover: c.hover }]);
        setAddName('');
        setAddColorIdx(0);
        setShowAddForm(false);
      };

      const previousMonth = () => {
        setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1));
      };

      const nextMonth = () => {
        setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1));
      };

      const daysInMonth = getDaysInMonth(currentDate);
      const firstDay = getFirstDayOfMonth(currentDate);
      const days = [];

      for (let i = 0; i < firstDay; i++) {
        days.push(<div key={`empty-${i}`} className="aspect-square" />);
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const key = `${currentDate.getFullYear()}-${currentDate.getMonth()}-${day}`;
        const entry = getLegendEntry(coloredDays[key]);
        days.push(
          <button
            key={day}
            onClick={() => handleDayClick(day)}
            className={`aspect-square border border-gray-300 rounded-lg flex items-center justify-center text-lg font-medium transition-colors ${entry.bg} ${entry.hover}`}
          >
            {day}
          </button>
        );
      }

      return (
        <div className="max-w-4xl mx-auto p-6 bg-white rounded-xl shadow-lg">
          <div className="mb-6">
            <div className="flex items-center justify-between mb-6">
              <button
                onClick={previousMonth}
                className="p-2 rounded-lg hover:bg-gray-100 transition-colors"
              >
                <ChevronLeft />
              </button>
              <h2 className="text-2xl font-bold">
                {monthNames[currentDate.getMonth()]} {currentDate.getFullYear()}
              </h2>
              <button
                onClick={nextMonth}
                className="p-2 rounded-lg hover:bg-gray-100 transition-colors"
              >
                <ChevronRight />
              </button>
            </div>

            <div className="grid grid-cols-7 gap-2 mb-2">
              {dayNames.map(day => (
                <div key={day} className="text-center font-semibold text-gray-600 text-sm">
                  {day}
                </div>
              ))}
            </div>

            <div className="grid grid-cols-7 gap-2">
              {days}
            </div>
          </div>

          <div className="border-t pt-4 mt-4">
            <h3 className="font-semibold mb-2">Legend</h3>
            <p className="text-sm text-gray-500 mb-3">Click days on the calendar to cycle colors. Customize labels below.</p>
            <div className="flex flex-wrap gap-2 mb-3">
              {legend.map((entry) => (
                <div key={entry.id} className="flex flex-col gap-1">
                  <div className="flex items-center gap-1.5 rounded-lg border border-gray-200 bg-gray-50 px-2 py-1.5">
                    {entry.id === 'none' ? (
                      <div className={`w-5 h-5 rounded border border-gray-300 shrink-0 ${entry.bg}`} />
                    ) : (
                      <button
                        type="button"
                        onClick={() => setEditingColorId(editingColorId === entry.id ? null : entry.id)}
                        className={`w-5 h-5 rounded border border-gray-300 shrink-0 ${entry.bg} hover:ring-2 hover:ring-gray-400`}
                        title="Change color"
                      />
                    )}
                    {editingId === entry.id ? (
                    <input
                      type="text"
                      value={newLabelName}
                      onChange={(e) => setNewLabelName(e.target.value)}
                      onBlur={() => updateLegendName(entry.id, newLabelName)}
                      onKeyDown={(e) => { if (e.key === 'Enter') updateLegendName(entry.id, newLabelName); }}
                      className="text-sm w-24 px-1 border rounded"
                      autoFocus
                    />
                  ) : (
                    <span className="text-sm">{entry.name}</span>
                  )}
                  {entry.id !== 'none' && (
                    <>
                      <button
                        type="button"
                        onClick={() => { setEditingId(entry.id); setNewLabelName(entry.name); }}
                        className="p-0.5 rounded hover:bg-gray-200 text-gray-500"
                        title="Edit name"
                      >
                        <Pencil />
                      </button>
                      <button
                        type="button"
                        onClick={() => removeLegendEntry(entry.id)}
                        className="p-0.5 rounded hover:bg-red-100 text-gray-500 hover:text-red-600"
                        title="Remove"
                      >
                        <Trash />
                      </button>
                    </>
                  )}
                  </div>
                  {editingColorId === entry.id && entry.id !== 'none' && (
                    <div className="flex flex-wrap gap-1 pl-7">
                      {COLOR_PALETTE.map((c, i) => (
                        <button
                          key={i}
                          type="button"
                          onClick={() => { updateLegendColor(entry.id, i); setEditingColorId(null); }}
                          className={`w-6 h-6 rounded border border-gray-300 ${c.bg} hover:ring-2 hover:ring-gray-500`}
                        />
                      ))}
                    </div>
                  )}
                </div>
              ))}
            </div>
            {!showAddForm ? (
              <button
                type="button"
                onClick={() => setShowAddForm(true)}
                className="flex items-center gap-1.5 text-sm text-blue-600 hover:text-blue-800 font-medium"
              >
                <Plus /> Add label
              </button>
            ) : (
              <div className="flex flex-wrap items-center gap-2 p-3 rounded-lg bg-gray-50 border border-gray-200">
                <input
                  type="text"
                  placeholder="Label name"
                  value={addName}
                  onChange={(e) => setAddName(e.target.value)}
                  className="text-sm px-2 py-1.5 border border-gray-300 rounded w-32"
                />
                <div className="flex flex-wrap gap-1">
                  {COLOR_PALETTE.map((c, i) => (
                    <button
                      key={i}
                      type="button"
                      onClick={() => setAddColorIdx(i)}
                      className={`w-6 h-6 rounded border-2 shrink-0 ${c.bg} ${addColorIdx === i ? 'border-gray-700 ring-1 ring-gray-400' : 'border-gray-300'}`}
                      title={`Color ${i + 1}`}
                    />
                  ))}
                </div>
                <button type="button" onClick={addLegendEntry} className="text-sm px-3 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700">
                  Add
                </button>
                <button type="button" onClick={() => { setShowAddForm(false); setAddName(''); setAddColorIdx(0); }} className="text-sm px-2 py-1.5 text-gray-600 hover:bg-gray-200 rounded">
                  Cancel
                </button>
              </div>
            )}
            <div className="mt-3 pt-3 border-t border-gray-100">
              <p className="text-xs text-gray-400">Click a label&apos;s color swatch to change it. Use the pencil to rename, or the trash to remove.</p>
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ColorCalendar />);
  </script>
</body>
</html>
